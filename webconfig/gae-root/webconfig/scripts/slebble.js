var Slebble=function(){"use strict";function e(e){k&&console.log(e)}function t(e){f.style.display="none";var t=document.querySelector("#"+e);t.style.display="block",f=t}function n(){return purl().param("version")}function l(){return k?localStorage.data:purl().param("setting")}function r(){if("1.1.0"===n()){var e=document.querySelector("#startPage");e.innerHTML='<div class="highlight-module  highlight-module--right   highlight-module--learning"><div class="highlight-module__container  icon-exclamation "><div class="highlight-module__content   g-wide--push-1 g-wide--pull-1  g-medium--pull-1   "><p class="highlight-module__title"> New update</p><p class="highlight-module__text"> There is or will be a update very soon for this app. Unload and load the app at My Pebble and hope for a new update! </p></div></div></div>'+e.innerHTML}}function i(){var e=l();void 0!==e&&""!==e&&(e=JSON.parse(e),p=e.route,document.querySelector("#depature-range").value=e.maxDepatures,P.changePerformance(),L.value=e.provider,o())}function o(){h.innerHTML="",0===p.length&&(h.innerHTML="<p>No stations set</p>",b.innerHTML="<p>No stations set</p>");for(var e=0;e<p.length;e++)h.innerHTML+='<li><span class="list__item">'+p[e].from+'</span><a class="deleteIcon" onclick="Slebble.removeFrom(this)" data-index="'+e+'"><i class="icon icon-close"></i></a></li>';for(b.innerHTML="",e=0;e<p.length;e++)b.innerHTML+="<li>"+p[e].from+'</li><span class="filterSpan">Bus filter </span><input type="text" class="filter-field"  value="'+p[e].filter.join(", ")+'" data-index="'+e+'" '+(p[e].busFilterActive?"":"disabled")+'/><br><label for="filterEnable'+e+'" class="station-filter"><input type="checkbox" id="filterEnable'+e+'" class="filter-enabled" '+(p[e].busFilterActive?"checked":"")+' data-index="'+e+'"/>Enable filter</label></div>';a()}function a(){if(void 0!==p&&p.length>0){y=document.querySelectorAll(".filter-field");for(var e=0;e<y.length;e++)y[e].onchange=x;S=document.querySelectorAll(".station-filter");for(var t=0;t<S.length;t++)S[t].onclick=T}}function c(){return parseInt(q.value)}function u(){var e={};return e.route=p,e.maxDepatures=c(),e.provider=L.value,JSON.stringify(e)}function s(){v.value=""}function d(){var e=document.querySelector("#search-btn").children[0];H(e,"mglass")?(A(e,"mglass"),M(e,"ajax-loader")):(A(e,"ajax-loader"),M(e,"mglass"))}function m(){g.innerHTML="";var e=document.querySelector("#search-field").value;if(!(e.length<2)){d();var t,n=L.value,l="https://deductive-team-792.appspot.com/"+n+"/";k&&(l="http://localhost:8080/"+n+"/");var r=new XMLHttpRequest;r.open("GET",l+e,!0),r.onload=function(){if(4===r.readyState)if(d(),200===r.status){t=JSON.parse(r.responseText);for(var e=t.result.reverse(),n=e.length-1;n>=0;n--){var l=e[n];g.innerHTML+='<li><a type="button" class="list__item" onclick="Slebble.add(this);" data-id="'+l.id+'">'+l.name+"</a></li>"}}else document.querySelector("#results").innerHTML="<p>Request status: "+r.status+"<p>",console.log("Error"),console.log(r.status)},r.send(null)}}var f=document.querySelector("#startPage"),p=[],g=document.querySelector("#results"),v=document.querySelector("#search-field"),h=document.querySelector("#adding"),b=document.querySelector("#filterAdding"),y=document.querySelectorAll(".filter-field"),S=document.querySelectorAll(".filter-field"),q=document.querySelector("#depature-range"),L=document.querySelector("#provider"),k=!1,x=function(t){e(t);var n=t.srcElement,l=n.getAttribute("data-index");p[l].filter=n.value.split(",")},T=function(t){e(t);var n=t.srcElement,l=n.getAttribute("data-index");p[l].busFilterActive=n.checked===!0,y[l].disabled=!p[l].busFilterActive},A=function(e,t){e.classList?e.classList.remove(t):e.className=e.className.replace(new RegExp("(^|\\b)"+t.split(" ").join("|")+"(\\b|$)","gi")," ")},M=function(e,t){e.classList?e.classList.add(t):e.className+=" "+t},H=function(e,t){return e.classList?e.classList.contains(t):new RegExp("(^| )"+t+"( |$)","gi").test(e.className)},_=function(){var t="pebblejs://close#"+encodeURIComponent(u());e("Warping to: "+t),e(u()),k?(localStorage.data=u(),alert("Settings saved")):document.location=t},P={};return P.changePerformance=function(){var e=document.querySelector("#performance-display");A(e,"theme--user-input"),A(e,"theme--multi-device-layouts"),A(e,"theme--introduction-to-media");var t=document.querySelector("#depature-range");15===parseInt(t.value)&&M(e,"theme--user-input"),parseInt(t.value)<15&&M(e,"theme--multi-device-layouts"),parseInt(t.value)>15&&M(e,"theme--introduction-to-media"),document.querySelector("#depature-number").textContent=t.value},P.add=function(e){var n={};n.from=e.innerHTML,n.locationid=e.getAttribute("data-id"),n.filter=[],n.busFilterActive=!1,p[p.length]=n,o(),t("startPage"),s()},P.enterKeyPress=function(e){13===e.keyCode&&m()},P.removeFrom=function(e){p.splice(e.getAttribute("data-index"),1),o()},P.boot=function(){document.querySelector("#startLink").onclick=function(){t("startPage")},document.querySelector("#searchLink").onclick=function(){t("searchPage")},document.querySelector("#filterLink").onclick=function(){t("filterPage")},document.querySelector("#cancel").onclick=function(){k?alert("closing..."):document.location="pebblejs://close"},document.querySelector("#reset").onclick=function(){k?alert("resetting stuff"):document.location="pebblejs://close#reset"},document.querySelector("#submit").onclick=_,document.querySelector("#submit-toolbar").onclick=_,document.querySelector("#search-btn").onclick=function(e){e.preventDefault(),m()},L.onchange=function(){p=[],o()},t("startPage"),r(),i(),a()},P}();