var Slebble=function(){"use strict";function e(e){k&&console.log(e)}function t(e){p.style.display="none";var t=document.querySelector("#"+e);t.style.display="block",p=t}function n(){return purl().param("version")}function r(){return k?localStorage.data:purl().param("setting")}function o(){if("1.1.0"===n()){var e=document.querySelector("#startPage");e.innerHTML='<div class="highlight-module  highlight-module--right   highlight-module--learning"><div class="highlight-module__container  icon-exclamation "><div class="highlight-module__content   g-wide--push-1 g-wide--pull-1  g-medium--pull-1   "><p class="highlight-module__title"> New update</p><p class="highlight-module__text"> There is or will be a update very soon for this app. Unload and load the app at My Pebble and hope for a new update! </p></div></div></div>'+e.innerHTML}}function l(){var e=r();void 0!==e&&""!==e&&(e=JSON.parse(e),f=e.route,document.querySelector("#depature-range").value=e.maxDepatures,P.changePerformance(),q.value=e.provider,i())}function i(){v.innerHTML="",0===f.length&&(v.innerHTML="<p>No stations set</p>",y.innerHTML="<p>No stations set</p>");for(var e=0;e<f.length;e++)v.innerHTML+='<li><span class="list__item">'+f[e].from+'</span><a class="deleteIcon" onclick="Slebble.removeFrom(this)" data-index="'+e+'"><i class="icon icon-close"></i></a></li>';for(y.innerHTML="",e=0;e<f.length;e++)y.innerHTML+="<li>"+f[e].from+'</li><span class="filterSpan">Bus filter :</span><input type="text" class="filter-field"  value="'+f[e].filter.join(", ")+'" data-index="'+e+'"/></div>';a()}function a(){if(void 0!==f&&f.length>0){S=document.querySelectorAll(".filter-field");for(var e=0;e<S.length;e++)S[e].onchange=x}}function c(){return parseInt(b.value)}function u(){var e={};return e.route=f,e.maxDepatures=c(),e.provider=q.value,JSON.stringify(e)}function s(){h.value=""}function d(){var e=document.querySelector("#search-btn").children[0];H(e,"mglass")?(T(e,"mglass"),M(e,"ajax-loader")):(T(e,"ajax-loader"),M(e,"mglass"))}function m(){g.innerHTML="";var e=document.querySelector("#search-field").value;if(!(e.length<2)){d();var t,n=q.value,r="https://deductive-team-792.appspot.com/"+n+"/";k&&(r="http://localhost:8080/"+n+"/");var o=new XMLHttpRequest;o.open("GET",r+e,!0),o.onload=function(){if(4===o.readyState)if(d(),200===o.status){t=JSON.parse(o.responseText);for(var e=t.result.reverse(),n=e.length-1;n>=0;n--){var r=e[n];g.innerHTML+='<li><a type="button" class="list__item" onclick="Slebble.add(this);" data-id="'+r.id+'">'+r.name+"</a></li>"}}else document.querySelector("#results").innerHTML="<p>Request status: "+o.status+"<p>",console.log("Error"),console.log(o.status)},o.send(null)}}var p=document.querySelector("#startPage"),f=[],g=document.querySelector("#results"),h=document.querySelector("#search-field"),v=document.querySelector("#adding"),y=document.querySelector("#filterAdding"),S=document.querySelectorAll(".filter-field"),b=document.querySelector("#depature-range"),q=document.querySelector("#provider"),L=5,k=!0,x=function(t){e(t);var n=t.srcElement,r=n.getAttribute("data-index");f[r].filter=n.value.split(","),f[r].busFilterActive=0!==f[r].filter.length},T=function(e,t){e.classList?e.classList.remove(t):e.className=e.className.replace(new RegExp("(^|\\b)"+t.split(" ").join("|")+"(\\b|$)","gi")," ")},M=function(e,t){e.classList?e.classList.add(t):e.className+=" "+t},H=function(e,t){return e.classList?e.classList.contains(t):new RegExp("(^| )"+t+"( |$)","gi").test(e.className)},_=function(){var t="pebblejs://close#"+encodeURIComponent(u());e("Warping to: "+t),e(u()),k?(localStorage.data=u(),alert("Settings saved")):document.location=t},P={};return P.changePerformance=function(){var e=document.querySelector("#performance-display");T(e,"theme--user-input"),T(e,"theme--multi-device-layouts"),T(e,"theme--introduction-to-media");var t=document.querySelector("#depature-range");15===parseInt(t.value)&&M(e,"theme--user-input"),parseInt(t.value)<15&&M(e,"theme--multi-device-layouts"),parseInt(t.value)>15&&M(e,"theme--introduction-to-media"),document.querySelector("#depature-number").textContent=t.value},P.add=function(e){if(v.children.length!==L){var n={};n.from=e.innerHTML,n.locationid=e.getAttribute("data-id"),n.filter=[],n.busFilterActive=!1,f[f.length]=n,i()}t("startPage"),s()},P.enterKeyPress=function(e){13===e.keyCode&&m()},P.removeFrom=function(e){f.splice(e.getAttribute("data-index"),1),i()},P.boot=function(){document.querySelector("#startLink").onclick=function(){t("startPage")},document.querySelector("#searchLink").onclick=function(){t("searchPage")},document.querySelector("#filterLink").onclick=function(){t("filterPage")},document.querySelector("#cancel").onclick=function(){k?alert("closing..."):document.location="pebblejs://close"},document.querySelector("#reset").onclick=function(){k?alert("resetting stuff"):document.location="pebblejs://close#reset"},document.querySelector("#submit").onclick=_,document.querySelector("#submit-toolbar").onclick=_,document.querySelector("#search-btn").onclick=function(e){e.preventDefault(),m()},q.onchange=function(){f=[],i()},t("startPage"),o(),l(),a()},P}();